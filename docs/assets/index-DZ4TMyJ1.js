(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();var o;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.FFPROBE="FFPROBE",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(o||(o={}));const w=(()=>{let t=0;return()=>t++})(),I=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),L=new Error("called FFmpeg.terminate()");class y{#t=null;#i={};#r={};#n=[];#o=[];loaded=!1;#a=()=>{this.#t&&(this.#t.onmessage=({data:{id:e,type:r,data:i}})=>{switch(r){case o.LOAD:this.loaded=!0,this.#i[e](i);break;case o.MOUNT:case o.UNMOUNT:case o.EXEC:case o.FFPROBE:case o.WRITE_FILE:case o.READ_FILE:case o.DELETE_FILE:case o.RENAME:case o.CREATE_DIR:case o.LIST_DIR:case o.DELETE_DIR:this.#i[e](i);break;case o.LOG:this.#n.forEach(n=>n(i));break;case o.PROGRESS:this.#o.forEach(n=>n(i));break;case o.ERROR:this.#r[e](i);break}delete this.#i[e],delete this.#r[e]})};#e=({type:e,data:r},i=[],n)=>this.#t?new Promise((a,l)=>{const c=w();this.#t&&this.#t.postMessage({id:c,type:e,data:r},i),this.#i[c]=a,this.#r[c]=l,n?.addEventListener("abort",()=>{l(new DOMException(`Message # ${c} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(I);on(e,r){e==="log"?this.#n.push(r):e==="progress"&&this.#o.push(r)}off(e,r){e==="log"?this.#n=this.#n.filter(i=>i!==r):e==="progress"&&(this.#o=this.#o.filter(i=>i!==r))}load=({classWorkerURL:e,...r}={},{signal:i}={})=>(this.#t||(this.#t=e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL(""+new URL("worker-DYSz7Krg.js",import.meta.url).href,import.meta.url),{type:"module"}),this.#a()),this.#e({type:o.LOAD,data:r},void 0,i));exec=(e,r=-1,{signal:i}={})=>this.#e({type:o.EXEC,data:{args:e,timeout:r}},void 0,i);ffprobe=(e,r=-1,{signal:i}={})=>this.#e({type:o.FFPROBE,data:{args:e,timeout:r}},void 0,i);terminate=()=>{const e=Object.keys(this.#r);for(const r of e)this.#r[r](L),delete this.#r[r],delete this.#i[r];this.#t&&(this.#t.terminate(),this.#t=null,this.loaded=!1)};writeFile=(e,r,{signal:i}={})=>{const n=[];return r instanceof Uint8Array&&n.push(r.buffer),this.#e({type:o.WRITE_FILE,data:{path:e,data:r}},n,i)};mount=(e,r,i)=>{const n=[];return this.#e({type:o.MOUNT,data:{fsType:e,options:r,mountPoint:i}},n)};unmount=e=>{const r=[];return this.#e({type:o.UNMOUNT,data:{mountPoint:e}},r)};readFile=(e,r="binary",{signal:i}={})=>this.#e({type:o.READ_FILE,data:{path:e,encoding:r}},void 0,i);deleteFile=(e,{signal:r}={})=>this.#e({type:o.DELETE_FILE,data:{path:e}},void 0,r);rename=(e,r,{signal:i}={})=>this.#e({type:o.RENAME,data:{oldPath:e,newPath:r}},void 0,i);createDir=(e,{signal:r}={})=>this.#e({type:o.CREATE_DIR,data:{path:e}},void 0,r);listDir=(e,{signal:r}={})=>this.#e({type:o.LIST_DIR,data:{path:e}},void 0,r);deleteDir=(e,{signal:r}={})=>this.#e({type:o.DELETE_DIR,data:{path:e}},void 0,r)}var R;(function(t){t.MEMFS="MEMFS",t.NODEFS="NODEFS",t.NODERAWFS="NODERAWFS",t.IDBFS="IDBFS",t.WORKERFS="WORKERFS",t.PROXYFS="PROXYFS"})(R||(R={}));const g=""+new URL("ffmpeg-core-CI9Irx9p.js",import.meta.url).href,A=t=>new Promise((e,r)=>{const i=new FileReader;i.onload=()=>{const{result:n}=i;n instanceof ArrayBuffer?e(new Uint8Array(n)):e(new Uint8Array)},i.onerror=n=>{r(Error(`File could not be read! Code=${n?.target?.error?.code||-1}`))},i.readAsArrayBuffer(t)}),p=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(r=>r.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await A(t);else return new Uint8Array;return new Uint8Array(e)},_=document.getElementById("imageInput"),b=document.getElementById("audioInput"),N=document.getElementById("videoPreview"),E=document.getElementById("btnCreate"),D=document.getElementById("loading"),f=document.getElementById("btnDownload");let d=[],u=null;const U=2;_.addEventListener("change",t=>{d=Array.from(t.target.files)});b.addEventListener("change",t=>{u=t.target.files[0]||null});E.addEventListener("click",async()=>{if(!d.length)return alert("Chọn ảnh trước!");D.style.display="block",E.style.display="none",f.style.display="none";const t=new y;let e=[];const r="temp_video.mp4",i="output.mp4",n="input_audio.mp4";try{await t.load({coreURL:g});let a="";for(let s=0;s<d.length;s++){const m=`img${s}.jpg`,O=await p(d[s]);await t.writeFile(m,O),a+=`file '${m}'
duration ${U}
`}if(d.length>0&&(a+=`file 'img${d.length-1}.jpg'
`),await t.writeFile("list.txt",a),e=["-f","concat","-safe","0","-i","list.txt","-filter_complex",`scale=1080:1920:force_original_aspect_ratio=decrease,
       pad=1080:1920:(ow-iw)/2:(oh-ih)/2,
       fps=30`,"-r","30","-preset","veryfast","-b:v","5M","-an",r],console.log("Bước 1: Tạo video từ ảnh..."),await t.exec(e),u){console.log("Bước 2: Ghi và ghép âm thanh...");const s=await p(u);await t.writeFile(n,s),e=["-i",r,"-i",n,"-c:v","copy","-c:a","aac","-b:a","192k","-shortest",i],await t.exec(e)}else await t.rename(r,i);const l=await t.readFile(i),c=new Blob([l.buffer],{type:"video/mp4"}),h=URL.createObjectURL(c);N.src=h,f.style.display="inline-block",f.onclick=()=>{const s=document.createElement("a");s.href=h,s.download="slideshow.mp4",s.click()}}catch(a){console.error("Lỗi khi tạo video:",a),alert("Đã xảy ra lỗi trong quá trình tạo video. Vui lòng kiểm tra console.")}finally{D.style.display="none",E.style.display="inline-block"}});

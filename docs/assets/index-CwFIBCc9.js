(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var o;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.FFPROBE="FFPROBE",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(o||(o={}));const w=(()=>{let t=0;return()=>t++})(),I=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),L=new Error("called FFmpeg.terminate()");class g{#t=null;#r={};#i={};#n=[];#o=[];loaded=!1;#s=()=>{this.#t&&(this.#t.onmessage=({data:{id:e,type:i,data:r}})=>{switch(i){case o.LOAD:this.loaded=!0,this.#r[e](r);break;case o.MOUNT:case o.UNMOUNT:case o.EXEC:case o.FFPROBE:case o.WRITE_FILE:case o.READ_FILE:case o.DELETE_FILE:case o.RENAME:case o.CREATE_DIR:case o.LIST_DIR:case o.DELETE_DIR:this.#r[e](r);break;case o.LOG:this.#n.forEach(n=>n(r));break;case o.PROGRESS:this.#o.forEach(n=>n(r));break;case o.ERROR:this.#i[e](r);break}delete this.#r[e],delete this.#i[e]})};#e=({type:e,data:i},r=[],n)=>this.#t?new Promise((s,l)=>{const c=w();this.#t&&this.#t.postMessage({id:c,type:e,data:i},r),this.#r[c]=s,this.#i[c]=l,n?.addEventListener("abort",()=>{l(new DOMException(`Message # ${c} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(I);on(e,i){e==="log"?this.#n.push(i):e==="progress"&&this.#o.push(i)}off(e,i){e==="log"?this.#n=this.#n.filter(r=>r!==i):e==="progress"&&(this.#o=this.#o.filter(r=>r!==i))}load=({classWorkerURL:e,...i}={},{signal:r}={})=>(this.#t||(this.#t=e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/images-to-slideshow-video/assets/worker-DYSz7Krg.js",import.meta.url),{type:"module"}),this.#s()),this.#e({type:o.LOAD,data:i},void 0,r));exec=(e,i=-1,{signal:r}={})=>this.#e({type:o.EXEC,data:{args:e,timeout:i}},void 0,r);ffprobe=(e,i=-1,{signal:r}={})=>this.#e({type:o.FFPROBE,data:{args:e,timeout:i}},void 0,r);terminate=()=>{const e=Object.keys(this.#i);for(const i of e)this.#i[i](L),delete this.#i[i],delete this.#r[i];this.#t&&(this.#t.terminate(),this.#t=null,this.loaded=!1)};writeFile=(e,i,{signal:r}={})=>{const n=[];return i instanceof Uint8Array&&n.push(i.buffer),this.#e({type:o.WRITE_FILE,data:{path:e,data:i}},n,r)};mount=(e,i,r)=>{const n=[];return this.#e({type:o.MOUNT,data:{fsType:e,options:i,mountPoint:r}},n)};unmount=e=>{const i=[];return this.#e({type:o.UNMOUNT,data:{mountPoint:e}},i)};readFile=(e,i="binary",{signal:r}={})=>this.#e({type:o.READ_FILE,data:{path:e,encoding:i}},void 0,r);deleteFile=(e,{signal:i}={})=>this.#e({type:o.DELETE_FILE,data:{path:e}},void 0,i);rename=(e,i,{signal:r}={})=>this.#e({type:o.RENAME,data:{oldPath:e,newPath:i}},void 0,r);createDir=(e,{signal:i}={})=>this.#e({type:o.CREATE_DIR,data:{path:e}},void 0,i);listDir=(e,{signal:i}={})=>this.#e({type:o.LIST_DIR,data:{path:e}},void 0,i);deleteDir=(e,{signal:i}={})=>this.#e({type:o.DELETE_DIR,data:{path:e}},void 0,i)}var R;(function(t){t.MEMFS="MEMFS",t.NODEFS="NODEFS",t.NODERAWFS="NODERAWFS",t.IDBFS="IDBFS",t.WORKERFS="WORKERFS",t.PROXYFS="PROXYFS"})(R||(R={}));const y="/images-to-slideshow-video/assets/ffmpeg-core-CI9Irx9p.js",A=t=>new Promise((e,i)=>{const r=new FileReader;r.onload=()=>{const{result:n}=r;n instanceof ArrayBuffer?e(new Uint8Array(n)):e(new Uint8Array)},r.onerror=n=>{i(Error(`File could not be read! Code=${n?.target?.error?.code||-1}`))},r.readAsArrayBuffer(t)}),p=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(i=>i.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await A(t);else return new Uint8Array;return new Uint8Array(e)},_=document.getElementById("imageInput"),b=document.getElementById("audioInput"),N=document.getElementById("videoPreview"),E=document.getElementById("btnCreate"),D=document.getElementById("loading"),f=document.getElementById("btnDownload");let d=[],u=null;const U=2;_.addEventListener("change",t=>{d=Array.from(t.target.files)});b.addEventListener("change",t=>{u=t.target.files[0]||null});E.addEventListener("click",async()=>{if(!d.length)return alert("Chọn ảnh trước!");D.style.display="block",E.style.display="none",f.style.display="none";const t=new g;let e=[];const i="temp_video.mp4",r="output.mp4",n="input_audio.mp4";try{await t.load({coreURL:y});let s="";for(let a=0;a<d.length;a++){const m=`img${a}.jpg`,O=await p(d[a]);await t.writeFile(m,O),s+=`file '${m}'
duration ${U}
`}if(d.length>0&&(s+=`file 'img${d.length-1}.jpg'
`),await t.writeFile("list.txt",s),e=["-f","concat","-safe","0","-i","list.txt","-filter_complex",`scale=1080:1920:force_original_aspect_ratio=decrease,
       pad=1080:1920:(ow-iw)/2:(oh-ih)/2,
       fps=30`,"-r","30","-preset","veryfast","-b:v","5M","-an",i],console.log("Bước 1: Tạo video từ ảnh..."),await t.exec(e),u){console.log("Bước 2: Ghi và ghép âm thanh...");const a=await p(u);await t.writeFile(n,a),e=["-i",i,"-i",n,"-c:v","copy","-c:a","aac","-b:a","192k","-shortest",r],await t.exec(e)}else await t.rename(i,r);const l=await t.readFile(r),c=new Blob([l.buffer],{type:"video/mp4"}),h=URL.createObjectURL(c);N.src=h,f.style.display="inline-block",f.onclick=()=>{const a=document.createElement("a");a.href=h,a.download="slideshow.mp4",a.click()}}catch(s){console.error("Lỗi khi tạo video:",s),alert("Đã xảy ra lỗi trong quá trình tạo video. Vui lòng kiểm tra console.")}finally{D.style.display="none",E.style.display="inline-block"}});
